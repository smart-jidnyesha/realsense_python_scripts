import cv2
import pyrealsense2 as rs
import numpy as np

pipe = rs.pipeline()
config = rs.config()
config.enable_stream(rs.stream.depth,640,480,rs.format.z16,30)


pipe.start(config)

spatial = rs.spatial_filter()
spatial.set_option(rs.option.filter_magnitude,2)
spatial.set_option(rs.option.filter_smooth_alpha,0.5)
spatial.set_option(rs.option.filter_smooth_delta,20)



try:
    while True:
        frames=pipe.wait_for_frames()
        depth=frames.get_depth_frame()
        
        if not depth: continue
        filtered_depth = spatial.process(depth)
        np_img = np.asanyarray(filtered_depth.get_data())
        scale = depth.get_units()
        real_depths = np_img*scale
        print(np.shape(np_img), np.min(np_img), np.max(np_img), np.min(real_depths),np.max(real_depths),scale)
        # print(np.shape(color_img), np.min(color_img), np.max(color_img))
except KeyboardInterrupt:
    print("Exiting program")
    pipe.stop()



# Depth numpy array size = 480,848
"""
    [    0   326   327   328   329   330   331   332   333   334   335   336
   337   338   339   340   341   342   343   344   345   346   347   348
   349   350   351   352   353   354   355   356   357   358   359   360
   361   362   363   364   365   366   367   368   369   370   371   372
   373   374   375   376   378   379   380   381   382   383   384   385
   386   387   388   389   390   391   392   393   394   395   396   397
   398   399   400   406   407   408   409   410   411   432   433   434
   435   436   437   438   439   440   441   442   443   444   445   446
   447   448   449   450   451   452   454   455   456   457   458   459
   460   461   462   463   464   465   466   467   468   469   470   471
   476   477   478   479   480   482   483   484   485   486   487   488
   489   490   491   492   493   494   515   516   517   518   519   520
   521   522   523   524   525   526   527   528   529   530   533   534
   535   536   537   538   542   566   567   568   569   570   571   572
   589   592   593   594   595   596   622   623   624   665   666   667
   668   669   670   671   672   673   674   675   676   677   678   681
   710   711   712   713   783   786   787   788   789   790   791   805
   806   807   808   809   836   837   838   839   840   841   842   843
   844   986   987   988   989   990   992   993   994   995   996   997
   998  1006  1046  1048  1049  1051  1052  1053  1054  1055  1056  1057
  1058  1059  1060  1061  1062  1063  1064  1065  1066  1067  1068  1070
  1071  1072  1073  1075  1076  1077  1079  1080  1081  1082  1083  1084
  1085  1086  1087  1088  1089  1090  1091  1092  1093  1094  1095  1096
  1097  1099  1100  1101  1102  1104  1105  1106  1108  1109  1111  1112
  1113  1114  1115  1116  1117  1118  1119  1120  1121  1122  1123  1124
  1125  1126  1127  1129  1130  1132  1133  1135  1136  1137  1139  1140
  1142  1143  1144  1145  1146  1147  1148  1149  1150  1151  1152  1153
  1154  1155  1156  1157  1158  1159  1161  1162  1164  1165  1167  1168
  1169  1172  1173  1175  1176  1177  1178  1179  1180  1181  1182  1183
  1184  1185  1186  1188  1189  1190  1191  1192  1193  1195  1196  1198
  1200  1202  1203  1204  1206  1207  1210  1211  1212  1213  1214  1215
  1216  1217  1219  1220  1221  1222  1223  1224  1225  1227  1228  1229
  1231  1232  1235  1236  1238  1239  1241  1243  1244  1246  1248  1249
  1250  1251  1252  1254  1255  1256  1257  1258  1260  1261  1262  1263
  1265  1266  1267  1269  1271  1273  1274  1277  1278  1279  1282  1286
  1287  1288  1290  1291  1292  1293  1295  1296  1297  1299  1300  1301
  1302  1304  1305  1308  1310  1312  1314  1318  1319  1321  1324  1325
  1328  1329  1330  1332  1333  1336  1337  1338  1340  1341  1343  1344
  1345  1347  1349  1354  1355  1358  1359  1362  1365  1368  1369  1372
  1374  1375  1376  1378  1379  1381  1382  1384  1385  1387  1388  1390
  1391  1393  1394  1396  1397  1400  1402  1405  1406  1409  1411  1412
  1415  1417  1421  1423  1425  1426  1428  1429  1431  1432  1434  1435
  1437  1439  1440  1442  1443  1445  1447  1450  1451  1455  1456  1460
  1461  1463  1466  1468  1471  1473  1474  1476  1478  1479  1481  1483
  1484  1486  1488  1490  1491  1493  1495  1496  1498  1500  1503  1505
  1510  1514  1515  1517  1521  1522  1526  1528  1530  1539  1540  1542
  1544  1546  1548  1550  1551  1553  1555  1561  1563  1599  1601  1603
  1605  1607  1609  1611  1613  1615  1617  1619  1623  1625  1629  1631
  1635  1637  1639  1643  1645  1649  1651  1654  1656  1658  1660  1662
  1664  1666  1668  1670  1673  1675  1677  1679  1681  1683  1686  1690
  1692  1696  1699  1703  1705  1708  1712  1714  1719  1721  1723  1726
  1728  1730  1732  1735  1737  1739  1742  1744  1746  1749  1751  1753
  1756  1758  1763  1765  1770  1772  1777  1780  1782  1787  1789  1794
  1797  1799  1802  1804  1807  1809  1812  1814  1817  1819  1822  1824
  1827  1830  1832  1835  1837  1842  1845  1850  1853  1858  1861  1863
  1869  1871  1877  1880  1882  1885  1888  1890  1893  1896  1899  1901
  1904  1907  1910  1913  1915  1918  1921  1924  1930  1932  1938  1941
  1947  1950  1953  1958  1961  1967  1970  1973  1976  1979  1982  1985
  1988  1991  1994  1997  2000  2004  2007  2010  2013  2016  2019  2025
  2028  2035  2038  2044  2047  2051  2057  2060  2067  2070  2073  2077
  2080  2083  2087  2090  2093  2097  2100  2104  2107  2110  2114  2117
  2121  2124  2131  2134  2141  2145  2152  2156  2159  2166  2170  2177
  2181  2184  2188  2192  2195  2199  2203  2207  2210  2214  2218  2222
  2225  2229  2233  2237  2241  2248  2252  2260  2264  2272  2276  2280
  2288  2292  2300  2304  2308  2312  2316  2320  2324  2329  2333  2337
  2341  2437  2460  2465  2469  2474  2479  2483  2488  2493  2498  2502
  2507  2512  2517  2527  2532  2541  2546  2556  2561  2566  2577  2582
  2592  2597  2602  2607  2613  2618  2623  2628  2634  2639  2644  2650
  2655  2660  2666  2671  2677  2682  2693  2699  2710  2716  2727  2733
  2739  2750  2756  2768  2773  2779  2785  2791  2797  2803  2809  2815
  2821  2827  2834  2840  2846  2852  2858  2865  2871  2884  2890  2903
  2909  2922  2929  2936  2949  2955  2969  2976  2982  2989  2996  3003
  3010  3017  3024  3031  3038  3045  3052  3059  3066  3074  3081  3088
  3103  3110  3125  3133  3148  3155  3163  3178  3186  3202  3210  3217
  3225  3233  3241  3249  3258  3266  3274  3282  3290  3299  3307  3315
  3332  3341  3358  3367  3384  3393  3411  3420  3429  3447  3456  3474
  3483  3493  3502  3521  3531  3540  3550  3559  3569  3579  3589  3599
  3609  3619  3629  3639  3659  3669  3701  3722  3732  3743  3765  3775
  3797  3808  3820  3831  3853  3865  3876  3899  3911  3923  3947  3958
  3971  3983  4019  4032  4057  4069  4095  4121  4147  4160  4187  4200
  4214  4228  4255  4269  4283  4340  4398  4428  4474  4504  4552  4567
  4584  4616  4665  9072  9135  9199 10126 10450 10707 10886 10977 11070
 11165 11261 11359 11459 11560 12934 13063 13330 13467 13751 13897 14046
 62205 65315 65535]
    
    """